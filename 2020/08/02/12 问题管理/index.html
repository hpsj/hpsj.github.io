<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>问题管理 | Hp's blog</title><meta name="description" content="问题管理"><meta name="author" content="Hp's blog"><meta name="copyright" content="Hp's blog"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="问题管理"><meta name="twitter:description" content="问题管理"><meta name="twitter:image" content="http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg"><meta property="og:type" content="article"><meta property="og:title" content="问题管理"><meta property="og:url" content="https://hpsj.github.io/2020/08/02/12%20%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86/"><meta property="og:site_name" content="Hp's blog"><meta property="og:description" content="问题管理"><meta property="og:image" content="http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://hpsj.github.io/2020/08/02/12%20%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86/"><link rel="prev" title="概览 &amp; 统计" href="https://hpsj.github.io/2020/08/02/13%20%E6%A6%82%E8%A7%88%20&amp;%20%E7%BB%9F%E8%AE%A1/"><link rel="next" title="文件管理" href="https://hpsj.github.io/2020/08/02/11%20%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">35</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-问题管理"><span class="toc-number">1.</span> <span class="toc-text">12 问题管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1问题管理的表结构设置"><span class="toc-number">1.1.</span> <span class="toc-text">12.1问题管理的表结构设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-知识点"><span class="toc-number">1.2.</span> <span class="toc-text">12.2 知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-1-bootstrap-select选择框的使用"><span class="toc-number">1.2.1.</span> <span class="toc-text">12.2.1 bootstrap-select选择框的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-2-Bootstrap-datepicker日期选择器"><span class="toc-number">1.2.2.</span> <span class="toc-text">12.2.2 Bootstrap-datepicker日期选择器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-3-select2选择器"><span class="toc-number">1.2.3.</span> <span class="toc-text">12.2.3 select2选择器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-问题管理页面"><span class="toc-number">1.3.</span> <span class="toc-text">12.3 问题管理页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-新建问题"><span class="toc-number">1.4.</span> <span class="toc-text">12.4 新建问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-分页"><span class="toc-number">1.5.</span> <span class="toc-text">12.5 分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-6-编辑问题"><span class="toc-number">1.6.</span> <span class="toc-text">12.6  编辑问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-1-编辑问题表结构设置"><span class="toc-number">1.6.1.</span> <span class="toc-text">12.6.1 编辑问题表结构设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-2-构造编辑页面的url地址"><span class="toc-number">1.6.2.</span> <span class="toc-text">12.6.2 构造编辑页面的url地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-3-编辑问题的视图函数"><span class="toc-number">1.6.3.</span> <span class="toc-text">12.6.3 编辑问题的视图函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-4-编辑问题前端代码"><span class="toc-number">1.6.4.</span> <span class="toc-text">12.6.4 编辑问题前端代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-5-问题更新-amp-问题更新触发ajax请求"><span class="toc-number">1.6.5.</span> <span class="toc-text">12.6.5 问题更新 &amp; 问题更新触发ajax请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-6-6-后端更新问题"><span class="toc-number">1.6.6.</span> <span class="toc-text">12.6.6 后端更新问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-7-问题讨论（回复嵌套）"><span class="toc-number">1.7.</span> <span class="toc-text">12.7 问题讨论（回复嵌套）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-1-构造问题评论的url-地址"><span class="toc-number">1.7.1.</span> <span class="toc-text">12.7.1 构造问题评论的url 地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-2-问题评论初始化，发送ajax请求"><span class="toc-number">1.7.2.</span> <span class="toc-text">12.7.2 问题评论初始化，发送ajax请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-3-js嵌套展示问题评论"><span class="toc-number">1.7.3.</span> <span class="toc-text">12.7.3 js嵌套展示问题评论</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-4-后端处理"><span class="toc-number">1.7.4.</span> <span class="toc-text">12.7.4 后端处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-7-5-评论-amp-回复"><span class="toc-number">1.7.5.</span> <span class="toc-text">12.7.5 评论 &amp; 回复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-8-筛选"><span class="toc-number">1.8.</span> <span class="toc-text">12.8 筛选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-9-邀请对象"><span class="toc-number">1.9.</span> <span class="toc-text">12.9 邀请对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-1-表结构设置"><span class="toc-number">1.9.1.</span> <span class="toc-text">12.9.1 表结构设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-2-邀请成员模态框"><span class="toc-number">1.9.2.</span> <span class="toc-text">12.9.2 邀请成员模态框</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-3-生成邀请码"><span class="toc-number">1.9.3.</span> <span class="toc-text">12.9.3 生成邀请码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-9-4-访问邀请码"><span class="toc-number">1.9.4.</span> <span class="toc-text">12.9.4 访问邀请码</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Hp's blog</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">问题管理</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-02 15:55:25"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-08-02</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-02 16:22:33"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-08-02</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SaaS%E5%B9%B3%E5%8F%B0/">SaaS平台</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h2 id="12-问题管理"><a href="#12-问题管理" class="headerlink" title="12 问题管理"></a>12 问题管理</h2><p><img src="/" class="lazyload" data-src="http://hp256.gitee.io/blog/Django%E5%9B%BE%E7%89%87/%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2.jpg"  alt="问题管理页面"></p>
<p><img src="/" class="lazyload" data-src="http://hp256.gitee.io/blog/Django%E5%9B%BE%E7%89%87/%E6%96%B0%E5%BB%BA%E9%97%AE%E9%A2%98.png"  alt="新建问题"></p>
<p><img src="/" class="lazyload" data-src="http://hp256.gitee.io/blog/Django%E5%9B%BE%E7%89%87/%E9%82%80%E8%AF%B7%E6%88%90%E5%91%98.jpg"  alt="邀请成员"></p>
<p><img src="/" class="lazyload" data-src="http://hp256.gitee.io/blog/Django%E5%9B%BE%E7%89%87/%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86.jpg"  alt="问题管理"></p>
<h3 id="12-1问题管理的表结构设置"><a href="#12-1问题管理的表结构设置" class="headerlink" title="12.1问题管理的表结构设置"></a>12.1问题管理的表结构设置</h3><p><strong>问题</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>项目</th>
<th>问题类型</th>
<th>主题</th>
<th>模块</th>
<th>问题描述</th>
<th>状态</th>
<th>优先级</th>
<th>指派</th>
<th>关注者</th>
<th>开始时间</th>
<th>结束时间</th>
<th>模式</th>
<th>父问题</th>
<th>创建者</th>
<th>最后更新时间</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>模块</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>项目</th>
<th>模块</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>第一期网页的注册</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>第二期网页的登陆</td>
</tr>
</tbody></table>
<p><strong>问题类型</strong></p>
<table>
<thead>
<tr>
<th>ID</th>
<th>项目</th>
<th>问题类型</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>任务</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>功能</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>Bug</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Module</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">""" 模块(里程碑) """</span></span><br><span class="line">    project = models.ForeignKey(verbose_name=<span class="string">"项目"</span>, to=<span class="string">'Project'</span>)</span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">"模块名称"</span>, max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IssuesTyle</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">""" 问题类型 ：任务、功能、Bug"""</span></span><br><span class="line"></span><br><span class="line">    PROJECT_INIT_LIST = [<span class="string">"任务"</span>,<span class="string">"功能"</span>,<span class="string">"Bug"</span>]</span><br><span class="line"></span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">"类型名称"</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    project = models.ForeignKey(verbose_name=<span class="string">"项目"</span>, to=<span class="string">'Project'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Issues</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">""" 问题 """</span></span><br><span class="line">    project = models.ForeignKey(verbose_name=<span class="string">"项目"</span>, to=<span class="string">'Project'</span>)</span><br><span class="line">    issues_type = models.ForeignKey(verbose_name=<span class="string">"问题类型"</span>, to=<span class="string">'IssuesTyle'</span>)</span><br><span class="line"></span><br><span class="line">    module = models.ForeignKey(verbose_name=<span class="string">"模块"</span>, to=<span class="string">'Module'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    subject = models.CharField(verbose_name=<span class="string">"主题"</span>, max_length=<span class="number">32</span>)</span><br><span class="line">    desc = models.TextField(verbose_name=<span class="string">"问题描述"</span>)</span><br><span class="line">    priority_choices = (</span><br><span class="line">        (<span class="string">"danger"</span>, <span class="string">"高"</span>),</span><br><span class="line">        (<span class="string">"warning"</span>, <span class="string">"中"</span>),</span><br><span class="line">        (<span class="string">"success"</span>, <span class="string">"低"</span>),</span><br><span class="line">    )</span><br><span class="line">    priority = models.CharField(verbose_name=<span class="string">"优先级"</span>, max_length=<span class="number">12</span>, choices=priority_choices, default=<span class="string">'danger'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 新建、处理中、已解决、已忽略、待反馈、关闭、重新打开</span></span><br><span class="line">    status_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'新建'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'处理中'</span>),</span><br><span class="line">        (<span class="number">3</span>, <span class="string">'已解决'</span>),</span><br><span class="line">        (<span class="number">4</span>, <span class="string">'已忽略'</span>),</span><br><span class="line">        (<span class="number">5</span>, <span class="string">'待反馈'</span>),</span><br><span class="line">        (<span class="number">6</span>, <span class="string">'关闭'</span>),</span><br><span class="line">        (<span class="number">7</span>, <span class="string">'重新打开'</span>),</span><br><span class="line">    )</span><br><span class="line">    status = models.SmallIntegerField(verbose_name=<span class="string">'状态'</span>, choices=status_choices, default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    assign = models.ForeignKey(verbose_name=<span class="string">'指派给'</span>, to=<span class="string">"UserInfo"</span>, related_name=<span class="string">'task'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    attention = models.ManyToManyField(verbose_name=<span class="string">'关注者'</span>, to=<span class="string">"UserInfo"</span>, related_name=<span class="string">'observer'</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    start_date = models.DateField(verbose_name=<span class="string">'开始时间'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    end_date = models.DateField(verbose_name=<span class="string">'结束时间'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    mode_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">'公开模式'</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">'隐私模式'</span>),</span><br><span class="line">    )</span><br><span class="line">    mode = models.SmallIntegerField(verbose_name=<span class="string">'模式'</span>, choices=mode_choices, default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    parent = models.ForeignKey(verbose_name=<span class="string">'父问题'</span>, to=<span class="string">"self"</span>, related_name=<span class="string">'child'</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>,</span><br><span class="line">                               on_delete=models.SET_NULL)</span><br><span class="line"></span><br><span class="line">    creator = models.ForeignKey(verbose_name=<span class="string">'创建者'</span>, to=<span class="string">"UserInfo"</span>, related_name=<span class="string">'create_problems'</span>)</span><br><span class="line"></span><br><span class="line">    create_datetime = models.DateTimeField(verbose_name=<span class="string">'创建时间'</span>, auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    latest_update_datetime = models.DateTimeField(verbose_name=<span class="string">'最后更新时间'</span>, auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.subject</span><br></pre></td></tr></table></figure>

<h3 id="12-2-知识点"><a href="#12-2-知识点" class="headerlink" title="12.2 知识点"></a>12.2 知识点</h3><h4 id="12-2-1-bootstrap-select选择框的使用"><a href="#12-2-1-bootstrap-select选择框的使用" class="headerlink" title="12.2.1 bootstrap-select选择框的使用"></a>12.2.1 bootstrap-select选择框的使用</h4><ul>
<li><p>下载bootstrap-select的css代码与js代码</p>
<p><a href="https://www.bootstrapselect.cn/" target="_blank" rel="noopener">https://www.bootstrapselect.cn/</a></p>
</li>
<li><p>导入css代码与js代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/css/bootstrap-select.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/bootstrap-select.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/i18n/defaults-zh_CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用法：将<code>selectpicker</code>类添加到<code>select</code>元素以自动初始化<code>bootstrap-select</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"selectpicker"</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="12-2-2-Bootstrap-datepicker日期选择器"><a href="#12-2-2-Bootstrap-datepicker日期选择器" class="headerlink" title="12.2.2 Bootstrap-datepicker日期选择器"></a>12.2.2 Bootstrap-datepicker日期选择器</h4><p><a href="https://bootstrap-datepicker.readthedocs.io/en/latest/" target="_blank" rel="noopener">https://bootstrap-datepicker.readthedocs.io/en/latest/</a></p>
<ul>
<li><p>下载Bootstrap-datepicker的css与js</p>
<p><a href="https://github.com/uxsolutions/bootstrap-datepicker/blob/master/docs/index.rst" target="_blank" rel="noopener">https://github.com/uxsolutions/bootstrap-datepicker/blob/master/docs/index.rst</a></p>
</li>
<li><p>导入css代码与js代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用法：在日期选择器上调用<code>datepicker方法</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.datepicker'</span>).datepicker(<span class="string">'method'</span>, arg1, arg2);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="12-2-3-select2选择器"><a href="#12-2-3-select2选择器" class="headerlink" title="12.2.3 select2选择器"></a>12.2.3 select2选择器</h4><p>select2与bootstrap-select都为下拉框选择器，不过select2更加强大。</p>
<p><a href="https://select2.org/" target="_blank" rel="noopener">https://select2.org/</a></p>
<ul>
<li><p>下载select2的js与css代码</p>
<p><a href="https://github.com/select2/select2" target="_blank" rel="noopener">https://github.com/select2/select2</a></p>
</li>
<li><p>导入js与css</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/select2/css/select2.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/select2/js/select2.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/select2/js/i18n/zh-CN.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用法：调用 <code>.select2()</code> 在要初始化Select2的任何jQuery选择器上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'.js-example-basic-single'</span>).select2();</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="12-3-问题管理页面"><a href="#12-3-问题管理页面" class="headerlink" title="12.3 问题管理页面"></a>12.3 问题管理页面</h3><ul>
<li><p><strong>构造url代码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目管理</span></span><br><span class="line">url(<span class="string">r'^manage/(?P&lt;project_id&gt;\d+)/'</span>, include([</span><br><span class="line">    <span class="comment"># 问题管理</span></span><br><span class="line">	url(<span class="string">r'^issues/$'</span>, issues.issues, name=<span class="string">'issues'</span>),</span><br><span class="line">], <span class="literal">None</span>, <span class="literal">None</span>)),</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>构造form表单</strong></p>
<p>在forms文件夹下新建issues.py文件存放问题管理的相关的form表单的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> web <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> web.forms.bootstrap <span class="keyword">import</span> BootSrtapForm</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IssuesModelForm</span><span class="params">(BootSrtapForm,forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Issues</span><br><span class="line">        exclude = [<span class="string">'project'</span>,<span class="string">'creator'</span>,<span class="string">'create_datetime'</span>,<span class="string">'latest_update_datetime'</span>]</span><br><span class="line"></span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="comment"># 为select框加上class属性，值为selectpicker。</span></span><br><span class="line">            <span class="comment"># 使用bootstrap-selec选择器</span></span><br><span class="line">            </span><br><span class="line">            <span class="string">"issues_type"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">'selectpicker'</span>,&#125;),</span><br><span class="line">            <span class="string">"priority"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">'selectpicker'</span>,&#125;),</span><br><span class="line">            <span class="string">"status"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">'selectpicker'</span>,&#125;),</span><br><span class="line">            <span class="string">"mode"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">'selectpicker'</span>,&#125;),</span><br><span class="line">            <span class="string">"parent"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">'selectpicker'</span>,<span class="string">"data-live-search"</span>:<span class="string">"true"</span>&#125;),</span><br><span class="line">            <span class="string">"assign"</span>:forms.Select(attrs=&#123;<span class="string">'class'</span>:<span class="string">"selectpicker"</span>,<span class="string">"data-live-search"</span>:<span class="string">"true"</span>&#125;),</span><br><span class="line">            <span class="string">"attention"</span>:forms.SelectMultiple(attrs=&#123;<span class="string">'class'</span>:<span class="string">"selectpicker"</span>,<span class="string">"data-live-search"</span>:<span class="string">"true"</span>,<span class="string">"data-actions-box"</span>:<span class="string">"true"</span>&#125;),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,request,*args,**kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args,**kwargs)</span><br><span class="line">        self.request = request</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 处理数据初始化</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. 获取当前项目的所有问题类型 [(1,'xx'),(2,'xx')]</span></span><br><span class="line">        self.fields[<span class="string">'issues_type'</span>].choices = models.IssuesTyle.objects.filter(project=request.tracer.project).values_list(<span class="string">'id'</span>,<span class="string">'title'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 获取当前项目的所有模块</span></span><br><span class="line">        module_list = [(<span class="string">""</span>,<span class="string">"没有选中任何项"</span>),]</span><br><span class="line">        module_obj_list = models.Module.objects.filter(project=request.tracer.project).values_list(<span class="string">'id'</span>, <span class="string">'title'</span>)</span><br><span class="line">        module_list.extend(module_obj_list)</span><br><span class="line">        self.fields[<span class="string">'module'</span>].choices = module_list</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 指派 &amp; 关注者</span></span><br><span class="line">        <span class="comment"># 数据库中找到当前项目的参与者 &amp; 创建者</span></span><br><span class="line">        total_user_list = [(request.tracer.project.creator_id,request.tracer.project.creator.username),]</span><br><span class="line">        project_user_list = models.ProjectUser.objects.filter(project=request.tracer.project).values_list(<span class="string">'user_id'</span>,<span class="string">'user__username'</span>)</span><br><span class="line"></span><br><span class="line">        total_user_list.extend(project_user_list)</span><br><span class="line">        self.fields[<span class="string">'assign'</span>].choices = [(<span class="string">''</span>,<span class="string">'没有选中任何项'</span>)] + total_user_list</span><br><span class="line">        self.fields[<span class="string">'attention'</span>].choices = total_user_list</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 4. 当前项目已创建的问题</span></span><br><span class="line">        parent_list = [(<span class="string">""</span>,<span class="string">"没有选中任何项"</span>)]</span><br><span class="line">        parent_obj_list = models.Issues.objects.filter(project=request.tracer.project).values_list(<span class="string">'id'</span>,<span class="string">'subject'</span>)</span><br><span class="line">        parent_list.extend(parent_obj_list)</span><br><span class="line">        self.fields[<span class="string">'parent'</span>].choices = parent_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 问题的回复</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目的邀请码</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p><strong>由于form表单生成的至于理想的不同，原因是，模块和是ForeignKey，需要获取关联的表的值。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CheckFilter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, data_list, request)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.data_list = data_list</span><br><span class="line">        self.request = request</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">""""</span></span><br><span class="line"><span class="string">        priority_choices = (</span></span><br><span class="line"><span class="string">        ("danger", "高"),</span></span><br><span class="line"><span class="string">        ("warning", "中"),</span></span><br><span class="line"><span class="string">        ("success", "低"),</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.data_list:</span><br><span class="line">            key = str(item[<span class="number">0</span>])</span><br><span class="line">            text = item[<span class="number">1</span>]</span><br><span class="line">            ck = <span class="string">""</span></span><br><span class="line">            <span class="comment"># 判断如果当前用户请求的URL中status和当前循环key相等</span></span><br><span class="line">            value_list = self.request.GET.getlist(self.name)</span><br><span class="line">            <span class="comment"># print(value_list)</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> value_list:</span><br><span class="line">                ck = <span class="string">'checked'</span></span><br><span class="line">                value_list.remove(key)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                value_list.append(key)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 生成url</span></span><br><span class="line">            <span class="comment"># 在当前的url参数增加一项</span></span><br><span class="line">            query_dict = self.request.GET.copy()</span><br><span class="line">            query_dict._mutable = <span class="literal">True</span></span><br><span class="line">            query_dict.setlist(self.name, value_list)  <span class="comment"># &#123;'status':[1,2,3]&#125;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'page'</span> <span class="keyword">in</span> query_dict:</span><br><span class="line">                query_dict.pop(<span class="string">'page'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 移除？号</span></span><br><span class="line">            param_url = query_dict.urlencode()</span><br><span class="line">            <span class="keyword">if</span> param_url:</span><br><span class="line">                <span class="comment"># urlencode可以把字典生成，status=1&amp;status=2&amp;status=3</span></span><br><span class="line">                url = <span class="string">"&#123;&#125;?&#123;&#125;"</span>.format(self.request.path_info,query_dict.urlencode())  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                url = self.request.path_info</span><br><span class="line"></span><br><span class="line">            html = <span class="string">'&lt;a class="cell" href="&#123;url&#125;"&gt;&lt;input type="checkbox" &#123;ck&#125;/&gt;&lt;label&gt;&#123;text&#125;&lt;/label&gt;&lt;/a&gt;'</span>.format(url=url,ck=ck,text=text)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">yield</span> mark_safe(html)</span><br></pre></td></tr></table></figure>





</li>
</ul>
<ul>
<li><p><strong>与上面原因相同，form表单与理想的不同，原因关注者是ManyToManyField，需要关联的表的值。</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SelectFilter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, data_list, request)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.data_list = data_list</span><br><span class="line">        self.request = request</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> mark_safe(<span class="string">"&lt;select class='select2' multiple='multiple' style='width:100%'&gt;"</span>)</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.data_list:</span><br><span class="line">            key = str(item[<span class="number">0</span>])</span><br><span class="line">            text = item[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            selected = <span class="string">""</span></span><br><span class="line">            value_list = self.request.GET.getlist(self.name)</span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> value_list:</span><br><span class="line">                selected = <span class="string">"selected"</span></span><br><span class="line">                value_list.remove(key)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                value_list.append(key)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 生成url</span></span><br><span class="line">            <span class="comment"># 在当前的url参数增加一项</span></span><br><span class="line">            query_dict = self.request.GET.copy()</span><br><span class="line">            query_dict._mutable = <span class="literal">True</span></span><br><span class="line">            query_dict.setlist(self.name, value_list)  <span class="comment"># &#123;'status':[1,2,3]&#125;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'page'</span> <span class="keyword">in</span> query_dict:</span><br><span class="line">                query_dict.pop(<span class="string">'page'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 移除？号</span></span><br><span class="line">            param_url = query_dict.urlencode()</span><br><span class="line">            <span class="keyword">if</span> param_url:</span><br><span class="line">                <span class="comment"># urlencode可以把字典生成，status=1&amp;status=2&amp;status=3</span></span><br><span class="line">                url = <span class="string">"&#123;&#125;?&#123;&#125;"</span>.format(self.request.path_info,query_dict.urlencode())  </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                url = self.request.path_info</span><br><span class="line"></span><br><span class="line">            html = <span class="string">"&lt;option value='&#123;url&#125;' &#123;selected&#125;&gt;&#123;text&#125;&lt;/option&gt;"</span>.format(url=url,selected=selected, text=text)</span><br><span class="line">            <span class="keyword">yield</span> mark_safe(html)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> mark_safe(<span class="string">"&lt;/select&gt;"</span>)</span><br></pre></td></tr></table></figure>





</li>
</ul>
<ul>
<li><p><strong>问题管理的视图函数</strong></p>
<p>新建<code>issues.py</code>文件，用于存放问题管理相关的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues</span><span class="params">(request, project_id)</span>:</span></span><br><span class="line">    <span class="string">""" 问题列表 """</span></span><br><span class="line">    form = IssuesModelForm(request)</span><br><span class="line">    issues_obj_list = queryset[page.start:page.end]</span><br><span class="line">    project_issues_type = models.IssuesTyle.objects.filter(project_id=project_id).values_list(<span class="string">'id'</span>, <span class="string">'title'</span>)</span><br><span class="line"></span><br><span class="line">    project_total_user = [(request.tracer.project.creator_id, request.tracer.project.creator.username)]</span><br><span class="line">    project_join_user = models.ProjectUser.objects.filter(project_id=project_id).values_list(<span class="string">'user_id'</span>,<span class="string">'user__username'</span>)</span><br><span class="line">    project_total_user.extend(project_join_user)</span><br><span class="line">    </span><br><span class="line">    context = &#123;</span><br><span class="line">            <span class="string">'form'</span>: form,</span><br><span class="line">            <span class="string">'filter_list'</span>: [</span><br><span class="line">                &#123;<span class="string">'title'</span>: <span class="string">'问题类型'</span>, <span class="string">'filter'</span>: CheckFilter(<span class="string">'issues_type'</span>, project_issues_type, request)&#125;,</span><br><span class="line">                &#123;<span class="string">'title'</span>: <span class="string">'状态'</span>, <span class="string">'filter'</span>: CheckFilter(<span class="string">'status'</span>, models.Issues.status_choices, request)&#125;,</span><br><span class="line">                &#123;<span class="string">'title'</span>: <span class="string">'优先级'</span>, <span class="string">'filter'</span>: CheckFilter(<span class="string">'priority'</span>, models.Issues.priority_choices, request)&#125;,</span><br><span class="line">                &#123;<span class="string">'title'</span>: <span class="string">'指派者'</span>, <span class="string">'filter'</span>: SelectFilter(<span class="string">'assign'</span>, project_total_user, request)&#125;,</span><br><span class="line">                &#123;<span class="string">'title'</span>: <span class="string">'关注者'</span>, <span class="string">'filter'</span>: SelectFilter(<span class="string">'attention'</span>, project_total_user, request)&#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'manage/issues.html'</span>, context)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p><strong>问题管理issues.html的相关代码</strong></p>
<p>在manage文件夹下，新建issues.html文件用于存放问题管里的前端代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'layout/manage.html' %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line">&#123;% load issues %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block css %&#125;</span><br><span class="line">	<span class="comment">&lt;!-- 引用bootstrap-datepicker日期选择器和bootstrap-select选择器 --&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/editor-md/css/editormd.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/css/bootstrap-select.min.css' %&#125;"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.issues-list</span> <span class="selector-class">.number</span> &#123;</span></span><br><span class="line">            width: 100px;</span><br><span class="line">            text-align: right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.issues-list</span> <span class="selector-class">.number</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line">            font-weight: 500;</span><br><span class="line">            padding: 0 10px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.issues-list</span> <span class="selector-class">.issue</span> <span class="selector-class">.tags</span> &#123;</span></span><br><span class="line">            padding: 10px 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.issues-list</span> <span class="selector-class">.issue</span> <span class="selector-class">.tags</span> <span class="selector-tag">span</span> &#123;</span></span><br><span class="line">            margin-right: 20px;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.issues-list</span> <span class="selector-class">.issue</span> <span class="selector-class">.tags</span> <span class="selector-class">.type</span> &#123;</span></span><br><span class="line">            color: white;</span><br><span class="line">            padding: 1px 5px;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.editormd</span> &#123;</span></span><br><span class="line">            margin-bottom: 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.pd-0</span> &#123;</span></span><br><span class="line">            padding: 0 !important;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.form-group</span> &#123;</span></span><br><span class="line">            margin-bottom: 17px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">        筛选</span><br><span class="line">         */</span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">            margin-bottom: 15px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> <span class="selector-tag">title</span> &#123;</span></span><br><span class="line">            padding: 5px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> <span class="selector-class">.check-list</span> <span class="selector-tag">a</span> &#123;</span></span><br><span class="line">            text-decoration: none;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            min-width: 65px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> <span class="selector-class">.check-list</span> <span class="selector-tag">label</span> &#123;</span></span><br><span class="line">            font-weight: 200;</span><br><span class="line">            font-size: 13px;</span><br><span class="line">            margin-left: 3px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> <span class="selector-class">.check-list</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line">            font-weight: 300;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.filter-area</span> <span class="selector-class">.item</span> <span class="selector-class">.check-list</span> <span class="selector-class">.cell</span> &#123;</span></span><br><span class="line">            margin-right: 10px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-id">#inviteForm</span> <span class="selector-tag">div</span> &#123;</span></span><br><span class="line">            margin-bottom: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#inviteArea</span> <span class="selector-tag">hr</span>&#123;</span></span><br><span class="line">            margin-top: 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid clearfix"</span> <span class="attr">style</span>=<span class="string">"padding: 20px 0;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-3"</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">            <span class="comment">&lt;!--  筛选的相关代码  --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-quora"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 问题<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-success btn-sm"</span> <span class="attr">data-toggle</span>=<span class="string">"modal"</span> <span class="attr">data-target</span>=<span class="string">"#addModal"</span>&gt;</span>新建问题<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-sm"</span> <span class="attr">data-toggle</span>=<span class="string">"modal"</span> <span class="attr">data-target</span>=<span class="string">"#inviteModal"</span>&gt;</span>邀请成员<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">class</span>=<span class="string">"issues-list"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    &#123;% for item in issues_obj_list %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"number"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-circle text-&#123;&#123; item.priority &#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'issues_detail' project_id=request.tracer.project.id issues_id=item.id %&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>&#123;% string_just item.id %&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"issue"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'issues_detail' project_id=request.tracer.project.id issues_id=item.id %&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>&#123;&#123; item.subject &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tags"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"type"</span> <span class="attr">style</span>=<span class="string">"background-color: #56b8eb"</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; item.issues_type.title &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-refresh"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; item.get_status_display &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-user-o"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; item.creator.username &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;% if item.assign %&#125;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-hand-o-right"</span></span></span><br><span class="line"><span class="tag">                                               <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; item.assign.username &#125;&#125;</span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">                                    &#123;% if item.end_date %&#125;</span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-calendar"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; item.end_date &#125;&#125; 截止</span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                    &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-clock-o"</span></span></span><br><span class="line"><span class="tag">                                           <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; item.latest_update_datetime &#125;&#125; 更新</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 分页的相关代码  --&gt;</span></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Modal --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"addModal"</span> <span class="attr">class</span>=<span class="string">"modal fade bs-example-modal-lg"</span> <span class="attr">tabindex</span>=<span class="string">"-1"</span> <span class="attr">role</span>=<span class="string">"dialog"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">aria-labelledby</span>=<span class="string">"myLargeModalLabel"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-dialog modal-lg"</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-content"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-header"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span> <span class="attr">aria-label</span>=<span class="string">"Close"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"modal-title"</span>&gt;</span>新建问题<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-body"</span> <span class="attr">style</span>=<span class="string">"padding-right: 40px"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"addForm"</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span>&gt;</span></span><br><span class="line">                        &#123;% csrf_token %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.issues_type.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.issues_type.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    &#123;&#123; form.issues_type &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.subject.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.subject.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.subject &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.module.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.module.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    &#123;&#123; form.module &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.desc.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.desc.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"editor"</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.desc &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.status.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.status.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.status &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.priority.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.priority.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.priority &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.assign.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.assign.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.assign &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.attention.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.attention.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.attention &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.start_date.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.start_date.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-calendar"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.start_date &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.end_date.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.end_date.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-calendar"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.end_date &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.mode.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.mode.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.mode &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.parent.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.parent.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.parent &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-footer"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span>&gt;</span>取 消<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">id</span>=<span class="string">"btnAddSubmit"</span>&gt;</span>添 加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 邀请成员的模态框代码 --&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% block js %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/editor-md/editormd.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/bootstrap-select.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/i18n/defaults-zh_CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> WIKI_UPLOAD_URL = <span class="string">"&#123;% url 'wiki_upload' project_id=request.tracer.project.id%&#125;"</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> INVITER_URL = <span class="string">"&#123;% url 'inviter_url' project_id=request.tracer.project.id%&#125;"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            bindBootStrapShownEvent();</span><br><span class="line">            initDatePicker();</span><br><span class="line">            bindAddSubmit();</span><br><span class="line">			initDatePicker();</span><br><span class="line">        &#125;);</span><br><span class="line">		</span><br><span class="line"><span class="actionscript">        <span class="comment">/* Bootstrap-datepicker日期选择器 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 开始时间，与结束时间*/</span></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">initDatePicker</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'#id_start_date,#id_end_date'</span>).datepicker(&#123;</span></span><br><span class="line"><span class="actionscript">                format: <span class="string">'yyyy-mm-dd'</span>,</span></span><br><span class="line"><span class="actionscript">                startData: <span class="string">'0'</span>,</span></span><br><span class="line"><span class="actionscript">                language: <span class="string">"zh-CN"</span>,</span></span><br><span class="line"><span class="actionscript">                autoclose: <span class="literal">true</span>,</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">bindBootStrapShownEvent</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'#addModal'</span>).on(<span class="string">'shown.bs.modal'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// 对话框弹出时，内容触发</span></span></span><br><span class="line">                initEditorMd();</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /*</span><br><span class="line">         初始化markdown编辑器(textare转为编辑器）</span><br><span class="line">         */</span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">initEditorMd</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            editormd(<span class="string">'editor'</span>, &#123;</span></span><br><span class="line"><span class="actionscript">                placeholder: <span class="string">"请输入内容"</span>,</span></span><br><span class="line">                height: 300,</span><br><span class="line"><span class="actionscript">                path: <span class="string">"&#123;% static 'plugin/editor-md/lib/' %&#125;"</span>,</span></span><br><span class="line"><span class="actionscript">                imageUpload: <span class="literal">true</span>,</span></span><br><span class="line"><span class="actionscript">                imageFormats: [<span class="string">"jpg"</span>, <span class="string">"jpeg"</span>, <span class="string">"png"</span>, <span class="string">"gif"</span>],</span></span><br><span class="line">                imageUploadURL: WIKI_UPLOAD_URL,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">       <span class="comment">// 新建问题</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="12-4-新建问题"><a href="#12-4-新建问题" class="headerlink" title="12.4 新建问题"></a>12.4 新建问题</h3><ul>
<li>给新建问题的按钮绑定事件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建问题</span></span><br><span class="line"><span class="keyword">var</span> POST_ISSUES = <span class="string">"&#123;% url 'issues' project_id=request.tracer.project.id%&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindAddSubmit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#btnAddSubmit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'#addForm'</span>).find(<span class="string">'.error-msg'</span>).empty();</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: POST_ISSUES,</span><br><span class="line">            type: <span class="string">"POST"</span>,</span><br><span class="line">            data: $(<span class="string">'#addForm'</span>).serialize(),</span><br><span class="line">            dataType: <span class="string">"JSON"</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.status) &#123;</span><br><span class="line">                    location.href = location.href;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.each(res.error, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">                        $(<span class="string">'#id_'</span> + key).parent().next(<span class="string">'.error-msg'</span>).text(value[<span class="number">0</span>])</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>后端处理</p>
<p>问题管理页面与新建问题用的是同一个视图函数。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues</span><span class="params">(request, project_id)</span>:</span></span><br><span class="line">    <span class="string">""" 问题列表 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'manage/issues.html'</span>, context)</span><br><span class="line">    </span><br><span class="line">   	form = IssuesModelForm(request, data=request.POST)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        <span class="comment"># 添加问题</span></span><br><span class="line">        form.instance.project = request.tracer.project</span><br><span class="line">        form.instance.creator = request.tracer.user</span><br><span class="line">        form.save()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: form.errors&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="12-5-分页"><a href="#12-5-分页" class="headerlink" title="12.5 分页"></a>12.5 分页</h3><p>在utils文件下创建pangination.py文件，用于存放分页的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pagination</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,request,data_length,per_num=<span class="number">10</span>,max_show=<span class="number">11</span>)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            page = int(request.GET.get(<span class="string">'page'</span>, <span class="string">'1'</span>))</span><br><span class="line">            <span class="keyword">if</span> page &lt;= <span class="number">0</span>:</span><br><span class="line">                page = <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            page = <span class="number">1</span></span><br><span class="line">        <span class="comment"># print(page,type(page))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 每页显示的数据条数 per_num = 10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># request.GET.copy()返回一个可编辑的深拷贝</span></span><br><span class="line">        qd = request.GET.copy()</span><br><span class="line">        <span class="comment"># 对url进行编辑</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 总页码数</span></span><br><span class="line">        total_num, more = divmod(data_length, per_num)</span><br><span class="line">        <span class="keyword">if</span> more:</span><br><span class="line">            total_num += <span class="number">1</span></span><br><span class="line">        <span class="comment"># print(total_num)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> page &gt; total_num:</span><br><span class="line">            page = total_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 要显示的页码数</span></span><br><span class="line">        <span class="comment"># max_show = 11</span></span><br><span class="line">        half_show = max_show // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> total_num &lt;= max_show:</span><br><span class="line">            <span class="comment"># 页码的起始值</span></span><br><span class="line">            page_start = <span class="number">1</span></span><br><span class="line">            <span class="comment"># 页码的终止值</span></span><br><span class="line">            page_end = total_num</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 处理左边极值</span></span><br><span class="line">            <span class="keyword">if</span> page - half_show &lt;= <span class="number">0</span>:</span><br><span class="line">                page_start = <span class="number">1</span></span><br><span class="line">                page_end = max_show</span><br><span class="line">            <span class="keyword">elif</span> page + half_show &gt;= total_num:</span><br><span class="line">                page_start = total_num - max_show + <span class="number">1</span></span><br><span class="line">                page_end = total_num</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                page_start = page - half_show</span><br><span class="line">                page_end = page + half_show</span><br><span class="line"></span><br><span class="line">        page_list = [<span class="string">'&lt;nav aria-label="Page navigation"&gt;&lt;ul class="pagination"&gt;'</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> page == <span class="number">1</span>:</span><br><span class="line">            page_list.append(<span class="string">'&lt;li class="disabled"&gt;&lt;a&gt;&lt;span aria-hidden="true"&gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>)    <span class="comment"># disabled不能点击</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            qd[<span class="string">'page'</span>] = page<span class="number">-1</span></span><br><span class="line">            page_list.append(<span class="string">'&lt;li&gt;&lt;a href="?&#123;&#125;"&gt;&lt;span aria-hidden="true"&gt;上一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>.format(qd.urlencode()))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(page_start, page_end + <span class="number">1</span>):</span><br><span class="line">            qd[<span class="string">'page'</span>] = i</span><br><span class="line">            <span class="keyword">if</span> i == page:</span><br><span class="line">                page_list.append(<span class="string">'&lt;li class="active"&gt;&lt;a href="?&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(qd.urlencode(), i))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                page_list.append(<span class="string">'&lt;li&gt;&lt;a href="?&#123;&#125;"&gt;&#123;&#125;&lt;/a&gt;&lt;/li&gt;'</span>.format(qd.urlencode(), i))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> page == total_num:</span><br><span class="line">            page_list.append(<span class="string">'&lt;li class="disabled"&gt;&lt;a&gt;&lt;span aria-hidden="true"&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            qd[<span class="string">'page'</span>] = page+<span class="number">1</span></span><br><span class="line">            page_list.append(<span class="string">'&lt;li&gt;&lt;a href="?&#123;&#125;"&gt;&lt;span aria-hidden="true"&gt;下一页&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;'</span>.format(qd.urlencode()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        page_list.append(<span class="string">'&lt;li class="disabled"&gt;&lt;a&gt;共%s条数据,页码%s/%s页&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/nav&gt;'</span>%(data_length,page,total_num))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.page_html = <span class="string">''</span>.join(page_list)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 切片的起始值</span></span><br><span class="line"></span><br><span class="line">        self.start = (page - <span class="number">1</span>) * per_num</span><br><span class="line">        <span class="keyword">if</span> self.start &lt; <span class="number">0</span> :</span><br><span class="line">            self.start = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 切片的终止值</span></span><br><span class="line">        self.end = page * per_num</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>视图函数引入分页</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> utils.pangination <span class="keyword">import</span> Pagination</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues</span><span class="params">(request, project_id)</span>:</span></span><br><span class="line">    <span class="string">""" 问题列表 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        ....</span><br><span class="line">        <span class="comment"># 分页获取数据</span></span><br><span class="line">        queryset = models.Issues.objects.filter(project_id=project_id).filter(**condition)</span><br><span class="line">        page = Pagination(request, queryset.count(), per_num=<span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        form = IssuesModelForm(request)</span><br><span class="line">        ...</span><br><span class="line">        context = &#123;</span><br><span class="line">            <span class="string">'form'</span>: form,</span><br><span class="line">			....</span><br><span class="line">            <span class="string">'page_html'</span>: page.page_html,</span><br><span class="line">            ....</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'manage/issues.html'</span>, context</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># post请求</span></span><br><span class="line">    ....</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p><strong>前端代码</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页的相关代码  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">"Page navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination"</span> <span class="attr">style</span>=<span class="string">"margin-top: 0"</span>&gt;</span></span><br><span class="line">        &#123;&#123; page_html|safe &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>





</li>
</ul>
<h3 id="12-6-编辑问题"><a href="#12-6-编辑问题" class="headerlink" title="12.6  编辑问题"></a>12.6  编辑问题</h3><h4 id="12-6-1-编辑问题表结构设置"><a href="#12-6-1-编辑问题表结构设置" class="headerlink" title="12.6.1 编辑问题表结构设置"></a>12.6.1 编辑问题表结构设置</h4><table>
<thead>
<tr>
<th>ID</th>
<th>内容</th>
<th>类型</th>
<th>评论者</th>
<th>时间</th>
<th>FK自己</th>
<th>FK问题</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td>回复</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>修改记录</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IssuesReplay</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""问题回复"""</span></span><br><span class="line">    replay_type_choices = ((<span class="number">1</span>,<span class="string">'修改记录'</span>),(<span class="number">2</span>,<span class="string">'回复'</span>))</span><br><span class="line">    replay_type = models.IntegerField(verbose_name=<span class="string">'类型'</span>,choices=replay_type_choices)</span><br><span class="line"></span><br><span class="line">    issues = models.ForeignKey(verbose_name=<span class="string">'问题'</span>,to=<span class="string">'Issues'</span>)</span><br><span class="line">    content = models.TextField(verbose_name=<span class="string">'描述'</span>)</span><br><span class="line">    creator = models.ForeignKey(verbose_name=<span class="string">'创建者'</span>,to=<span class="string">'UserInfo'</span>,related_name=<span class="string">'create_reply'</span>)</span><br><span class="line">    create_datetime = models.DateTimeField(verbose_name=<span class="string">'创建时间'</span>,auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    reply = models.ForeignKey(verbose_name=<span class="string">'回复'</span>,to=<span class="string">'self'</span>,null=<span class="literal">True</span>,blank=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h4 id="12-6-2-构造编辑页面的url地址"><a href="#12-6-2-构造编辑页面的url地址" class="headerlink" title="12.6.2 构造编辑页面的url地址"></a>12.6.2 构造编辑页面的url地址</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目管理</span></span><br><span class="line">url(<span class="string">r'^manage/(?P&lt;project_id&gt;\d+)/'</span>, include([</span><br><span class="line">    <span class="comment"># 问题管理</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment"># 编辑问题</span></span><br><span class="line">    url(<span class="string">r'^issues/detail/(?P&lt;issues_id&gt;\d+)/$'</span>, issues.issues_detail, name=<span class="string">'issues_detail'</span>),</span><br><span class="line">    <span class="comment"># 问题更新</span></span><br><span class="line">    url(<span class="string">r'^issues/change/(?P&lt;issues_id&gt;\d+)/$'</span>, issues.issues_change, name=<span class="string">'issues_change'</span>),</span><br><span class="line">], <span class="literal">None</span>, <span class="literal">None</span>)),</span><br></pre></td></tr></table></figure>



<h4 id="12-6-3-编辑问题的视图函数"><a href="#12-6-3-编辑问题的视图函数" class="headerlink" title="12.6.3 编辑问题的视图函数"></a>12.6.3 编辑问题的视图函数</h4><p>编辑问题与新建页面的基本一样，所以用同一个form表单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues_detail</span><span class="params">(request, project_id, issues_id)</span>:</span></span><br><span class="line">    <span class="string">""" 编辑问题 """</span></span><br><span class="line">    issues_obj = models.Issues.objects.filter(id=issues_id, project_id=project_id).first()</span><br><span class="line">    form = IssuesModelForm(request, instance=issues_obj)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"manage/issues_detail.html"</span>, &#123;<span class="string">'form'</span>: form, <span class="string">'issues_obj'</span>: issues_obj&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="12-6-4-编辑问题前端代码"><a href="#12-6-4-编辑问题前端代码" class="headerlink" title="12.6.4 编辑问题前端代码"></a>12.6.4 编辑问题前端代码</h4><p>在manage文件夹下创建issues_detail.html文件存放编辑问题的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'layout/manage.html' %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% load static %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% block css %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/editor-md/css/editormd.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/css/bootstrap-select.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">form</span><span class="selector-id">#editForm</span> &#123;</span></span><br><span class="line">            padding-right: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">            margin-top: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.left-avatar</span> &#123;</span></span><br><span class="line">            float: left;</span><br><span class="line">            margin-right: 10px;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            width: 30px;</span><br><span class="line">            height: 30px;</span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#304659</span>;</span></span><br><span class="line">            color: white;</span><br><span class="line">            text-align: center;</span><br><span class="line">            line-height: 30px;</span><br><span class="line">            border-radius: 50%;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.right-info</span> &#123;</span></span><br><span class="line">            padding-left: 35px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.right-info</span> <span class="selector-class">.desc</span> <span class="selector-class">.msg</span> &#123;</span></span><br><span class="line">            display: inline-block;</span><br><span class="line">            padding-right: 20px;</span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#8c8c8c</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.child</span> &#123;</span></span><br><span class="line">            padding-left: 55px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.error-msg</span> &#123;</span></span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.comment-area</span> <span class="selector-class">.reply-user</span> &#123;</span></span><br><span class="line">            display: inline-block;</span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#ddd</span>;</span></span><br><span class="line">            color: black;</span><br><span class="line">            padding: 6px 8px;</span><br><span class="line">            margin-left: 20px;</span><br><span class="line">            border-radius: 8px;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="selector-class">.editormd-fullscreen</span> &#123;</span></span><br><span class="line">            z-index: 1001;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid clearfix"</span> <span class="attr">style</span>=<span class="string">"padding: 20px 0;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-7"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading edit-heading"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-edit"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 更新问题</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"editForm"</span> <span class="attr">class</span>=<span class="string">"form-horizontal"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">                        &#123;% csrf_token %&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.issues_type.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.issues_type.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    &#123;&#123; form.issues_type &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.subject.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.subject.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.subject &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.module.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.module.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    &#123;&#123; form.module &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.desc.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                   <span class="attr">class</span>=<span class="string">"col-sm-2 control-label"</span>&gt;</span>&#123;&#123; form.desc.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-10"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"editor"</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.desc &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.status.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.status.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.status &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.priority.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.priority.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.priority &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.assign.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.assign.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.assign &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.attention.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.attention.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.attention &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.start_date.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.start_date.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-calendar"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.start_date &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.end_date.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.end_date.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-calendar"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        &#123;&#123; form.end_date &#125;&#125;</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group clearfix"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.mode.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.mode.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.mode &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 pd-0"</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; form.parent.id_for_label &#125;&#125;"</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">class</span>=<span class="string">"col-sm-4 control-label"</span>&gt;</span>&#123;&#123; form.parent.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8 clearfix"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                                    &#123;&#123; form.parent &#125;&#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-5"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-search"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 操作记录</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body comment-area"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-list"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"comment-text"</span> <span class="attr">id</span>=<span class="string">"commentText"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">rows</span>=<span class="string">"6"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"请输入回复内容"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">id</span>=<span class="string">"btnSubmit"</span> <span class="attr">value</span>=<span class="string">"提 交"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"reply-user hide"</span> <span class="attr">id</span>=<span class="string">"replyUser"</span>&gt;</span></span><br><span class="line">                            回复 <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-times-circle"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span> <span class="attr">style</span>=<span class="string">"color: #9d9d9d;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hide"</span> <span class="attr">id</span>=<span class="string">"recordTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item clearfix"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left-avatar"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right-info"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"desc"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-bullhorn"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"type"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-user-o"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"user"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"msg"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-clock-o"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#commentText"</span> <span class="attr">class</span>=<span class="string">"reply"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-commenting-o"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 回复</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block js %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/editor-md/editormd.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/bootstrap-select.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/bootstrap-select/js/i18n/defaults-zh_CN.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 上传图片 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> WIKI_UPLOAD_URL = <span class="string">"&#123;% url 'wiki_upload' project_id=request.tracer.project.id%&#125;"</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 问题更新 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> ISSUES_CHANGE_URL = <span class="string">"&#123;% url 'issues_change' project_id=request.tracer.project.id issues_id=issues_obj.id %&#125;"</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* markdown编辑器 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> EDITOR;</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            initDatePicker();</span><br><span class="line">            initEditorMd();</span><br><span class="line">            initIssuesRecord();</span><br><span class="line">            bindReply();</span><br><span class="line">            bindCancelReplyUser();</span><br><span class="line">            bindSubmit();</span><br><span class="line">            bindChangeIssues();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        <span class="comment">/* 日期选择器 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">initDatePicker</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'#id_start_date,#id_end_date'</span>).datepicker(&#123;</span></span><br><span class="line"><span class="actionscript">                format: <span class="string">'yyyy-mm-dd'</span>,</span></span><br><span class="line"><span class="actionscript">                startData: <span class="string">'0'</span>,</span></span><br><span class="line"><span class="actionscript">                language: <span class="string">"zh-CN"</span>,</span></span><br><span class="line"><span class="actionscript">                autoclose: <span class="literal">true</span>,</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        /*</span><br><span class="line">         初始化markdown编辑器(textare转为编辑器）</span><br><span class="line">         */</span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">initEditorMd</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            EDITOR = editormd(<span class="string">'editor'</span>, &#123;   <span class="comment">// EDITOR前面没写var为全局变量</span></span></span><br><span class="line"><span class="actionscript">                placeholder: <span class="string">"请输入内容"</span>,</span></span><br><span class="line">                height: 300,</span><br><span class="line"><span class="actionscript">                path: <span class="string">"&#123;% static 'plugin/editor-md/lib/' %&#125;"</span>,</span></span><br><span class="line"><span class="actionscript">                imageUpload: <span class="literal">true</span>,</span></span><br><span class="line"><span class="actionscript">                imageFormats: [<span class="string">"jpg"</span>, <span class="string">"jpeg"</span>, <span class="string">"png"</span>, <span class="string">"gif"</span>],</span></span><br><span class="line">                imageUploadURL: WIKI_UPLOAD_URL,</span><br><span class="line"><span class="actionscript">                toolbarAutoFixed: <span class="literal">false</span>, <span class="comment">//不固定窗口</span></span></span><br><span class="line"><span class="actionscript">                toolbarIcons: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123; <span class="comment">// 显示部分按钮</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">return</span> [<span class="string">'bold'</span>, <span class="string">'hr'</span>, <span class="string">'del'</span>, <span class="string">'italic'</span>, <span class="string">'quote'</span>, <span class="string">'|'</span>, <span class="string">'image'</span>, <span class="string">'preview'</span>, <span class="string">'watch'</span>, <span class="string">'fullscreen'</span>, <span class="string">'||'</span>, <span class="string">'save'</span>]</span></span><br><span class="line">                &#125;,</span><br><span class="line"><span class="actionscript">                toolbarCustomIcons: &#123;    <span class="comment">// 自定义按钮</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                    save: "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'button'</span> <span class="attr">value</span>=<span class="string">'保 存'</span> <span class="attr">class</span>=<span class="string">'btn btn-success btn-sm'</span> <span class="attr">onclick</span>=<span class="string">'saveDesc();'</span> /&gt;</span>"</span></span></span><br><span class="line">                &#125;,</span><br><span class="line"><span class="actionscript">                onload: <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;    <span class="comment">// 显示文本内容模式</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">this</span>.previewing();</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="actionscript">        <span class="comment">/* 问题更新 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 问题更新触发ajax请求 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 问题评论初始化 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 创建操作记录节点 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 问题回复 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 取消回复 */</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">/* 点击评论 */</span></span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span>    </span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>



<h4 id="12-6-5-问题更新-amp-问题更新触发ajax请求"><a href="#12-6-5-问题更新-amp-问题更新触发ajax请求" class="headerlink" title="12.6.5 问题更新 &amp; 问题更新触发ajax请求"></a>12.6.5 问题更新 &amp; 问题更新触发ajax请求</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 问题更新 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindChangeIssues</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#editForm'</span>).find(<span class="string">'.form-control'</span>).change(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 内容变更</span></span><br><span class="line">        <span class="keyword">var</span> postDict = &#123;<span class="attr">name</span>: $(<span class="keyword">this</span>).attr(<span class="string">'name'</span>), <span class="attr">value</span>: $(<span class="keyword">this</span>).val()&#125;;</span><br><span class="line">        postAjaxData(postDict);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveDesc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> postDict = &#123;<span class="attr">name</span>: <span class="string">'desc'</span>, <span class="attr">value</span>: EDITOR.getValue()&#125;;</span><br><span class="line">    postAjaxData(postDict);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 问题更新触发ajax请求 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postAjaxData</span>(<span class="params">postDict</span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#id_'</span> + postDict.name).parent().next(<span class="string">'.error-msg'</span>).text(<span class="string">''</span>);</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: ISSUES_CHANGE_URL,</span><br><span class="line">        type: <span class="string">"POST"</span>,</span><br><span class="line">        header: &#123;    <span class="comment">// 自定义请求头，告诉后端为Json格式，可以不加。</span></span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"application/json;charset=utf-8"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        data: <span class="built_in">JSON</span>.stringify(postDict),</span><br><span class="line">        dataType: <span class="string">"JSON"</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (res.status) &#123;</span><br><span class="line">                createRecordNode(res.data);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $(<span class="string">'#id_'</span> + postDict.name).parent().next(<span class="string">'.error-msg'</span>).text(res.error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="12-6-6-后端更新问题"><a href="#12-6-6-后端更新问题" class="headerlink" title="12.6.6 后端更新问题"></a>12.6.6 后端更新问题</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues_change</span><span class="params">(request, project_id, issues_id)</span>:</span></span><br><span class="line">    <span class="string">""" 更新问题 """</span></span><br><span class="line">    issues_obj = models.Issues.objects.filter(id=issues_id, project_id=project_id).first()</span><br><span class="line"></span><br><span class="line">    post_dict = json.loads(request.body.decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    &#123;'name': 'issues_type', 'value': '2'&#125;</span></span><br><span class="line"><span class="string">    &#123;'name': 'status', 'value': '2'&#125;</span></span><br><span class="line"><span class="string">    &#123;'name': 'priority', 'value': 'warning'&#125;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    name = post_dict.get(<span class="string">'name'</span>)</span><br><span class="line">    value = post_dict.get(<span class="string">'value'</span>)</span><br><span class="line">    print(post_dict)</span><br><span class="line">    field_obj = models.Issues._meta.get_field(name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_reply_record</span><span class="params">(content)</span>:</span></span><br><span class="line">        new_obj = models.IssuesReply.objects.create(</span><br><span class="line">            reply_type=<span class="number">1</span>,</span><br><span class="line">            issues=issues_obj,</span><br><span class="line">            content=change_record,</span><br><span class="line">            creator=request.tracer.user,</span><br><span class="line">        )</span><br><span class="line">        new_data = &#123;</span><br><span class="line">            <span class="string">'id'</span>: new_obj.id,</span><br><span class="line">            <span class="string">'reply_type_text'</span>: new_obj.get_reply_type_display(),</span><br><span class="line">            <span class="string">'content'</span>: new_obj.content,</span><br><span class="line">            <span class="string">'creator'</span>: new_obj.creator.username,</span><br><span class="line">            <span class="string">'datetime'</span>: new_obj.create_datetime.strftime(<span class="string">'%Y-%m-%m %H:%M'</span>),</span><br><span class="line">            <span class="string">'parent_id'</span>: new_obj.reply_id,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new_data</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 数据库字段更新</span></span><br><span class="line">    <span class="comment"># 1.1 文本</span></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> [<span class="string">'subject'</span>, <span class="string">'desc'</span>, <span class="string">'start_date'</span>, <span class="string">'end_date'</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> value:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> field_obj.null:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'该字段不能为空'</span>&#125;)</span><br><span class="line">            setattr(issues_obj, name, <span class="literal">None</span>)</span><br><span class="line">            issues_obj.save()</span><br><span class="line">            change_record = <span class="string">"&#123;&#125;更新为空"</span>.format(field_obj.verbose_name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            setattr(issues_obj, name, value)</span><br><span class="line">            issues_obj.save()</span><br><span class="line">            change_record = <span class="string">"&#123;&#125;更新为&#123;&#125;"</span>.format(field_obj.verbose_name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: create_reply_record(change_record)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.2 FK字段(指派要判断是否是创建者或者是参与者)</span></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> [<span class="string">'issues_type'</span>, <span class="string">'module'</span>, <span class="string">'assign'</span>, <span class="string">'parent'</span>]:</span><br><span class="line">        <span class="comment"># 用户选择为空</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> value:</span><br><span class="line">            <span class="comment"># 不允许为空</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> field_obj.null:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'该字段不能为空'</span>&#125;)</span><br><span class="line">            <span class="comment"># 允许为空</span></span><br><span class="line">            setattr(issues_obj, name, <span class="literal">None</span>)</span><br><span class="line">            issues_obj.save()</span><br><span class="line">            change_record = <span class="string">"&#123;&#125;更新为空"</span>.format(field_obj.verbose_name)</span><br><span class="line">        <span class="comment"># 用户输入不为空</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> name == <span class="string">'assign'</span>:</span><br><span class="line">                <span class="comment"># 是否是创建者</span></span><br><span class="line">                <span class="keyword">if</span> value == str(request.tracer.project.creator_id):</span><br><span class="line">                    instance = request.tracer.project.creator</span><br><span class="line">                <span class="comment"># 是否是参与者</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    project_user_obj = models.ProjectUser.objects.filter(project_id, user_id=value).first()</span><br><span class="line">                    <span class="keyword">if</span> project_user_obj:</span><br><span class="line">                        instance = project_user_obj.user</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        instance = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">                    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'该值不能存在'</span>&#125;)</span><br><span class="line"></span><br><span class="line">                setattr(issues_obj, name, instance)</span><br><span class="line">                issues_obj.save()</span><br><span class="line">                change_record = <span class="string">"&#123;&#125;更新为&#123;&#125;"</span>.format(field_obj.verbose_name, str(instance))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 条件判断：用户输入的值是自己的</span></span><br><span class="line">                <span class="comment"># field_obj.rel.model获取外键的to的值然后查询</span></span><br><span class="line">                instance = field_obj.rel.model.objects.filter(id=value, project_id=project_id).first()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> instance:</span><br><span class="line">                    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'该值不能存在'</span>&#125;)</span><br><span class="line"></span><br><span class="line">                setattr(issues_obj, name, instance)</span><br><span class="line">                issues_obj.save()</span><br><span class="line">                change_record = <span class="string">"&#123;&#125;更新为&#123;&#125;"</span>.format(field_obj.verbose_name, str(instance))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: create_reply_record(change_record)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.5 choices字段</span></span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> [<span class="string">'priority'</span>, <span class="string">'mode'</span>, <span class="string">'status'</span>]:</span><br><span class="line">        selected_text = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> key, text <span class="keyword">in</span> field_obj.choices:</span><br><span class="line">            <span class="keyword">if</span> str(key) == value:</span><br><span class="line">                selected_text = text</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> selected_text:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'该值不存在'</span>&#125;)</span><br><span class="line">        setattr(issues_obj, name, value)</span><br><span class="line">        issues_obj.save()</span><br><span class="line">        change_record = <span class="string">"&#123;&#125;更新为&#123;&#125;"</span>.format(field_obj.verbose_name, selected_text)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: create_reply_record(change_record)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.6 M2M字段</span></span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">"attention"</span>:</span><br><span class="line">        <span class="comment"># &#123;"name":"attention",value:[1,2,3]&#125;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, list):  <span class="comment"># isinstance列表类型</span></span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'数据格式错误'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> value:</span><br><span class="line">            issues_obj.attention.set([])</span><br><span class="line">            issues_obj.save()</span><br><span class="line">            change_record = <span class="string">"&#123;&#125;更新为空"</span>.format(field_obj.verbose_name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># values=[1,2,3,4]  id 是否是项目成员，包括创建者和参与者</span></span><br><span class="line">            <span class="comment"># 获取当前项目的所有成员</span></span><br><span class="line">            user_dict = &#123;str(request.tracer.project.creator_id): request.tracer.project.creator.username&#125;</span><br><span class="line">            project_user_list = models.ProjectUser.objects.filter(project_id=project_id)</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> project_user_list:</span><br><span class="line">                user_dict[str(item.user_id)] = item.user.username</span><br><span class="line"></span><br><span class="line">            username_list = []</span><br><span class="line">            <span class="keyword">for</span> user_id <span class="keyword">in</span> value:</span><br><span class="line">                username = user_dict.get(str(user_id))</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> username:</span><br><span class="line">                    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'用户不存在请重新设置'</span>&#125;)</span><br><span class="line">                username_list.append(username)</span><br><span class="line"></span><br><span class="line">            issues_obj.attention.set(value)</span><br><span class="line">            issues_obj.save()</span><br><span class="line">            change_record = <span class="string">"&#123;&#125;更新为&#123;&#125;"</span>.format(field_obj.verbose_name, <span class="string">','</span>.join(username_list))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: create_reply_record(change_record)&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: <span class="string">'滚'</span>&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="12-7-问题讨论（回复嵌套）"><a href="#12-7-问题讨论（回复嵌套）" class="headerlink" title="12.7 问题讨论（回复嵌套）"></a>12.7 问题讨论（回复嵌套）</h3><h4 id="12-7-1-构造问题评论的url-地址"><a href="#12-7-1-构造问题评论的url-地址" class="headerlink" title="12.7.1 构造问题评论的url 地址"></a>12.7.1 构造问题评论的url 地址</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目管理</span></span><br><span class="line">url(<span class="string">r'^manage/(?P&lt;project_id&gt;\d+)/'</span>, include([</span><br><span class="line">    <span class="comment"># 问题管理</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment"># 编辑问题</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题更新</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题讨论</span></span><br><span class="line">    url(<span class="string">r'^issues/record/(?P&lt;issues_id&gt;\d+)/$'</span>, issues.issues_record, name=<span class="string">'issues_record'</span>),</span><br><span class="line">], <span class="literal">None</span>, <span class="literal">None</span>)),</span><br></pre></td></tr></table></figure>

<h4 id="12-7-2-问题评论初始化，发送ajax请求"><a href="#12-7-2-问题评论初始化，发送ajax请求" class="headerlink" title="12.7.2 问题评论初始化，发送ajax请求"></a>12.7.2 问题评论初始化，发送ajax请求</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 问题评论</span></span><br><span class="line"><span class="keyword">var</span> ISSUES_RECORD_URL = <span class="string">"&#123;% url 'issues_record' project_id=request.tracer.project.id issues_id=issues_obj.id%&#125;"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> 问题评论的初始化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initIssuesRecord</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: ISSUES_RECORD_URL,</span><br><span class="line">        type: <span class="string">"GET"</span>,</span><br><span class="line">        dataType: <span class="string">"JSON"</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (res.status) &#123;</span><br><span class="line">                $.each(res.data, <span class="function"><span class="keyword">function</span> (<span class="params">index, item</span>) </span>&#123;</span><br><span class="line">                    createRecordNode(item);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-7-3-js嵌套展示问题评论"><a href="#12-7-3-js嵌套展示问题评论" class="headerlink" title="12.7.3 js嵌套展示问题评论"></a>12.7.3 js嵌套展示问题评论</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">创建操作记录节点</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createRecordNode</span>(<span class="params">nodeDict</span>) </span>&#123; <span class="comment">//nodeDict后端发过来的数据</span></span><br><span class="line">    <span class="keyword">var</span> $item = $(<span class="string">"#recordTemplate"</span>).find(<span class="string">'.item'</span>).clone();	<span class="comment">// 复制模板</span></span><br><span class="line">    $item.find(<span class="string">'.left-avatar'</span>).html(nodeDict.creator[<span class="number">0</span>].toUpperCase());</span><br><span class="line">    $item.find(<span class="string">'pre'</span>).html(nodeDict.content);</span><br><span class="line">    $item.find(<span class="string">'.user'</span>).html(nodeDict.creator);</span><br><span class="line">    $item.find(<span class="string">'.type'</span>).html(nodeDict.reply_type_text);</span><br><span class="line">    $item.find(<span class="string">'.date'</span>).html(nodeDict.datetime);</span><br><span class="line">    $item.attr(&#123;<span class="attr">id</span>: nodeDict.id, <span class="attr">username</span>: nodeDict.creator&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nodeDict.parent_id) &#123;</span><br><span class="line">        <span class="comment">// 挂在谁下</span></span><br><span class="line">        $(<span class="string">'#'</span> + nodeDict.parent_id).children(<span class="string">'.child'</span>).append($item);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 根下</span></span><br><span class="line">        $(<span class="string">'.comment-list'</span>).append($item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-7-4-后端处理"><a href="#12-7-4-后端处理" class="headerlink" title="12.7.4 后端处理"></a>12.7.4 后端处理</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues_record</span><span class="params">(request, project_id, issues_id)</span>:</span></span><br><span class="line">    <span class="string">""" 初始化操作记录 """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断是否可以评论和是否可以操作这个问题</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        reply_list = models.IssuesReply.objects.filter(issues_id=issues_id, issues__project=request.tracer.project)</span><br><span class="line">        <span class="comment"># 将queryset类型转为Json类型</span></span><br><span class="line">        data_list = []</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> reply_list:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'id'</span>: row.id,</span><br><span class="line">                <span class="string">'reply_type_text'</span>: row.get_reply_type_display(),</span><br><span class="line">                <span class="string">'content'</span>: row.content,</span><br><span class="line">                <span class="string">'creator'</span>: row.creator.username,</span><br><span class="line">                <span class="string">'datetime'</span>: row.create_datetime.strftime(<span class="string">'%Y-%m-%m %H:%M'</span>),</span><br><span class="line">                <span class="string">'parent_id'</span>: row.reply_id,</span><br><span class="line">            &#125;</span><br><span class="line">            data_list.append(data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: data_list&#125;)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># 评论 &amp; 回复</span></span><br></pre></td></tr></table></figure>



<h4 id="12-7-5-评论-amp-回复"><a href="#12-7-5-评论-amp-回复" class="headerlink" title="12.7.5 评论 &amp; 回复"></a>12.7.5 评论 &amp; 回复</h4><ul>
<li><p>给评论的按钮绑定事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">点击评论</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindSubmit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">'#btnSubmit'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'#commentText .error-msg'</span>).text(<span class="string">""</span>);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: ISSUES_RECORD_URL,</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            data: &#123;<span class="attr">content</span>: $(<span class="string">'#content'</span>).val(), <span class="attr">reply</span>: $(<span class="string">'#replyUser'</span>).attr(<span class="string">'parent-id'</span>)&#125;,</span><br><span class="line">            dataType: <span class="string">"JSON"</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.status) &#123;</span><br><span class="line">                    createRecordNode(res.data);</span><br><span class="line">                    <span class="comment">//输入框清空</span></span><br><span class="line">                    $(<span class="string">'#content'</span>).val(<span class="string">''</span>);</span><br><span class="line">                    $(<span class="string">'#replyUser'</span>).addClass(<span class="string">'hide'</span>).removeAttr(<span class="string">'parent-id'</span>).children(<span class="string">'span'</span>).text(<span class="string">""</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $.each(res.error, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">                        $(<span class="string">'#content'</span>).next(<span class="string">'.error-msg'</span>).text(value[<span class="number">0</span>])</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造form表单，对评论进行判断</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IssuesReplyModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.IssuesReply</span><br><span class="line">        fields = [<span class="string">'content'</span>,<span class="string">'reply'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>后端处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues_record</span><span class="params">(request, project_id, issues_id)</span>:</span></span><br><span class="line">    <span class="string">""" 初始化操作记录 """</span></span><br><span class="line">    </span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    form = IssuesReplyModelForm(data=request.POST)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        form.instance.issues_id = issues_id</span><br><span class="line">        form.instance.reply_type = <span class="number">2</span></span><br><span class="line">        form.instance.creator = request.tracer.user</span><br><span class="line">        instance = form.save()</span><br><span class="line">        info = &#123;</span><br><span class="line">            <span class="string">'id'</span>: instance.id,</span><br><span class="line">            <span class="string">'reply_type_text'</span>: instance.get_reply_type_display(),</span><br><span class="line">            <span class="string">'content'</span>: instance.content,</span><br><span class="line">            <span class="string">'creator'</span>: instance.creator.username,</span><br><span class="line">            <span class="string">'datetime'</span>: instance.create_datetime.strftime(<span class="string">'%Y-%m-%m %H:%M'</span>),</span><br><span class="line">            <span class="string">'parent_id'</span>: instance.reply_id,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: info&#125;)</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'error'</span>: form.errors&#125;)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="12-8-筛选"><a href="#12-8-筛选" class="headerlink" title="12.8 筛选"></a>12.8 筛选</h3><ul>
<li>后端接收到前端的url地址，实现筛选</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">issues</span><span class="params">(request, project_id)</span>:</span></span><br><span class="line">    <span class="string">""" 问题列表 """</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># 根据URL做筛选</span></span><br><span class="line">        allow_filter_name = [<span class="string">'issues_type'</span>, <span class="string">'status'</span>, <span class="string">'priority'</span>, <span class="string">'assign'</span>,<span class="string">'attention'</span>]</span><br><span class="line">        <span class="comment"># 筛选条件(根据用户通过GET传参实现)</span></span><br><span class="line">        <span class="comment"># ?status=1&amp;status=2&amp;issues_type=1</span></span><br><span class="line">        condition = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> allow_filter_name:</span><br><span class="line">            value_list = request.GET.getlist(name)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> value_list:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            condition[<span class="string">"&#123;&#125;__in"</span>.format(name)] = value_list</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        condition = &#123;</span></span><br><span class="line"><span class="string">            "status__in":[1,2],</span></span><br><span class="line"><span class="string">            "issues_type":[1,]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 分页获取数据</span></span><br><span class="line">        ....</span><br></pre></td></tr></table></figure>

<ul>
<li>前端代码，ForeignKey应用了select2组件进行短多选。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">select2组件应用的css代码</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'plugin/select2/css/select2.min.css' %&#125;"</span>&gt;</span></span><br><span class="line">....</span><br><span class="line"><span class="comment">&lt;!--  筛选的相关代码  --&gt;</span></span><br><span class="line">&#123;% for row in filter_list %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>&#123;&#123; row.title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"check-list"</span>&gt;</span></span><br><span class="line">        &#123;% for item in row.filter %&#125;</span><br><span class="line">        &#123;&#123; item &#125;&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">js代码</span><br><span class="line"></span><br><span class="line">select2组件应用的js代码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/select2/js/select2.min.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"&#123;% static 'plugin/select2/js/i18n/zh-CN.js' %&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        bindClickCheckFilter();</span><br><span class="line">        initSelect2();</span><br><span class="line">    &#125;);</span><br><span class="line">    /*</span><br><span class="line">    点击筛选checkbox</span><br><span class="line">     */</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">bindClickCheckFilter</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.filter-area'</span>).find(<span class="string">':checkbox'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            location.href = $(<span class="keyword">this</span>).parent().attr(<span class="string">'href'</span>);</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    /*</span><br><span class="line">    select2组件</span><br><span class="line">    */</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">initSelect2</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'.select2'</span>).select2(&#123;&#125;).on(<span class="string">'select2:select'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 选择某一项触发</span></span></span><br><span class="line">            location.href = e.params.data.id</span><br><span class="line"><span class="actionscript">        &#125;).on(<span class="string">'select2:unselect'</span>,<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 移除某一项触发</span></span></span><br><span class="line">            location.href = e.params.data.id</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="12-9-邀请对象"><a href="#12-9-邀请对象" class="headerlink" title="12.9 邀请对象"></a>12.9 邀请对象</h3><h4 id="12-9-1-表结构设置"><a href="#12-9-1-表结构设置" class="headerlink" title="12.9.1 表结构设置"></a>12.9.1 表结构设置</h4><table>
<thead>
<tr>
<th>ID</th>
<th>有效期</th>
<th>数量</th>
<th>使用数量</th>
<th>创建者</th>
<th>邀请码</th>
<th>项目</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>24</td>
<td></td>
<td></td>
<td>4</td>
<td>xxxx</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProjectInvite</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="string">"""项目邀请码"""</span></span><br><span class="line">    project = models.ForeignKey(verbose_name=<span class="string">"项目"</span>,to=<span class="string">"Project"</span>)</span><br><span class="line">    code = models.CharField(verbose_name=<span class="string">"邀请码"</span>,max_length=<span class="number">64</span>,unique=<span class="literal">True</span>)</span><br><span class="line">    count = models.PositiveIntegerField(verbose_name=<span class="string">"限制数量"</span>,null=<span class="literal">True</span>,blank=<span class="literal">True</span>,help_text=<span class="string">"空表示无数量限制"</span>)</span><br><span class="line">    use_count = models.PositiveIntegerField(verbose_name=<span class="string">'已邀请数量'</span>,default=<span class="number">0</span>)</span><br><span class="line">    period_choices = (</span><br><span class="line">    	(<span class="number">30</span>,<span class="string">'30分钟'</span>),</span><br><span class="line">    	(<span class="number">60</span>,<span class="string">'1小时'</span>),</span><br><span class="line">        (<span class="number">300</span>,<span class="string">'5小时'</span>),</span><br><span class="line">        (<span class="number">1440</span>,<span class="string">'24小时'</span>),</span><br><span class="line">    )</span><br><span class="line">    period = models.IntegerField(verbose_name=<span class="string">"有效期"</span>,choices=period_choices,default=<span class="number">1440</span>)</span><br><span class="line">    create_datetime = models.DateTimeField(verbose_name=<span class="string">"创建时间"</span>,auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    creator = models.ForeignKey(verbose_name=<span class="string">"创建者"</span>,to=<span class="string">"UserInfo"</span>,related_name=<span class="string">'create_invite'</span>)</span><br></pre></td></tr></table></figure>



<h4 id="12-9-2-邀请成员模态框"><a href="#12-9-2-邀请成员模态框" class="headerlink" title="12.9.2 邀请成员模态框"></a>12.9.2 邀请成员模态框</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 邀请成员的模态框代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal fade"</span> <span class="attr">id</span>=<span class="string">"inviteModal"</span> <span class="attr">tabindex</span>=<span class="string">"-1"</span> <span class="attr">role</span>=<span class="string">"dialog"</span> <span class="attr">aria-labelledby</span>=<span class="string">"myModalLabel"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-dialog"</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-content"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-header"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span> <span class="attr">aria-label</span>=<span class="string">"Close"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                                                                                                  <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="symbol">&amp;times;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"modal-title"</span> <span class="attr">id</span>=<span class="string">"myModalLabel"</span>&gt;</span>邀请成员<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-body"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"inviteForm"</span>&gt;</span></span><br><span class="line">                    &#123;% csrf_token %&#125;</span><br><span class="line">                    &#123;% for item in invite_form %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"&#123;&#123; item.id_for_label &#125;&#125;"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;% if item.help_text %&#125;(&#123;&#123; item.help_text &#125;&#125;)&#123;% endif %&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        &#123;&#123; item &#125;&#125;</span><br><span class="line">                        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error-msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span> <span class="attr">id</span>=<span class="string">"btnGenInviteCode"</span>&gt;</span>生成邀请码<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"inviteArea"</span> <span class="attr">class</span>=<span class="string">"hide"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"邀请链接"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">style</span>=<span class="string">"margin-left: 15px"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"inviteUrl"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"复制链接"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">id</span>=<span class="string">"btnCopyUrl"</span> <span class="attr">style</span>=<span class="string">"margin-right: 15px"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">相关的js代码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        bindCreateInviteCode();</span><br><span class="line">        bindCopyUrl();</span><br><span class="line">    &#125;);</span><br><span class="line">    /*</span><br><span class="line">    复制邀请码</span><br><span class="line">    */</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">bindCopyUrl</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#btnCopyUrl'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> textInput = $(<span class="string">'#inviteUrl'</span>)[<span class="number">0</span>]; <span class="comment">// 找到inviteUrl框</span></span></span><br><span class="line"><span class="actionscript">            textInput.select();     <span class="comment">// 选中框里面的内容</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.execCommand(<span class="string">"Copy"</span>);   <span class="comment">// 进行复制</span></span></span><br><span class="line"><span class="actionscript">            alert(<span class="string">'复制成功'</span>)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="12-9-3-生成邀请码"><a href="#12-9-3-生成邀请码" class="headerlink" title="12.9.3 生成邀请码"></a>12.9.3 生成邀请码</h4><ul>
<li><p>构造生成邀请码的url地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目管理</span></span><br><span class="line">url(<span class="string">r'^manage/(?P&lt;project_id&gt;\d+)/'</span>, include([</span><br><span class="line">    <span class="comment"># 问题管理</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment"># 编辑问题</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题更新</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题讨论</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 生成邀请码</span></span><br><span class="line">    url(<span class="string">r'^issues/inviter/url/$'</span>, issues.inviter_url, name=<span class="string">'inviter_url'</span>),</span><br><span class="line">], <span class="literal">None</span>, <span class="literal">None</span>)),</span><br></pre></td></tr></table></figure>
</li>
<li><p>form表单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InviteModelForm</span><span class="params">(BootSrtapForm,forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.ProjectInvite</span><br><span class="line">        fields = [<span class="string">'period'</span>,<span class="string">'count'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>后端生成邀请码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inviter_url</span><span class="params">(request, project_id)</span>:</span></span><br><span class="line">    <span class="string">"""生成邀请码"""</span></span><br><span class="line">    form = InviteModelForm(request.POST)</span><br><span class="line">    <span class="keyword">if</span> form.is_valid():</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        1.创建随机验证码</span></span><br><span class="line"><span class="string">        2.验证码保存到数据库</span></span><br><span class="line"><span class="string">        3.限制：只有创建者才能邀请</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> request.tracer.user != request.tracer.project.creator:</span><br><span class="line">            form.add_error(<span class="string">'period'</span>,<span class="string">'无权创建邀请码'</span>)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">False</span>, <span class="string">'form'</span>: form.errors&#125;)</span><br><span class="line"></span><br><span class="line">        random_invite_code = uid(request.tracer.user.mobile_phone)</span><br><span class="line">        form.instance.project = request.tracer.project</span><br><span class="line">        form.instance.code = random_invite_code</span><br><span class="line">        form.instance.creator = request.tracer.project.creator</span><br><span class="line">        form.save()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将验证码返回给前端，前端页面展示出来</span></span><br><span class="line">        url = <span class="string">"&#123;scheme&#125;://&#123;host&#125;&#123;path&#125;"</span>.format(</span><br><span class="line">            scheme=request.scheme,</span><br><span class="line">            host=request.get_host(),</span><br><span class="line">            path=reverse(<span class="string">'invite_join'</span>,kwargs=&#123;<span class="string">'code'</span>:random_invite_code&#125;)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>: <span class="literal">True</span>, <span class="string">'data'</span>: url&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="literal">False</span>,<span class="string">'form'</span>:form.errors&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>前端处理显示邀请码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">	/*</span><br><span class="line">     生成邀请码</span><br><span class="line">     */</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">bindCreateInviteCode</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#btnGenInviteCode'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.error-msg'</span>).empty();</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line">                url: INVITER_URL,</span><br><span class="line"><span class="actionscript">                type: <span class="string">"POST"</span>,</span></span><br><span class="line"><span class="javascript">                data: $(<span class="string">'#inviteForm'</span>).serialize(),</span></span><br><span class="line"><span class="actionscript">                dataType: <span class="string">"JSON"</span>,</span></span><br><span class="line"><span class="actionscript">                success: <span class="function"><span class="keyword">function</span> <span class="params">(res)</span> </span>&#123;</span></span><br><span class="line">                    if (res.status) &#123;</span><br><span class="line"><span class="javascript">                        $(<span class="string">'#inviteArea'</span>).removeClass(<span class="string">'hide'</span>).find(<span class="string">'#inviteUrl'</span>).val(res.data)</span></span><br><span class="line"><span class="actionscript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        $.each(res.error, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#id_'</span> + key).next(<span class="string">'.error-msg'</span>).text(value[<span class="number">0</span>])</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="12-9-4-访问邀请码"><a href="#12-9-4-访问邀请码" class="headerlink" title="12.9.4 访问邀请码"></a>12.9.4 访问邀请码</h4><ul>
<li><p>构造url请求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目管理</span></span><br><span class="line"><span class="comment"># 访问邀请码</span></span><br><span class="line">url(<span class="string">r'^invite/join/(?P&lt;code&gt;\w+)$'</span>, issues.invite_join, name=<span class="string">'invite_join'</span>),</span><br><span class="line">url(<span class="string">r'^manage/(?P&lt;project_id&gt;\d+)/'</span>, include([</span><br><span class="line">    <span class="comment"># 问题管理</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment"># 编辑问题</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题更新</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 问题讨论</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment"># 生成邀请码</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">], <span class="literal">None</span>, <span class="literal">None</span>)),</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>后端对邀请码访问进行处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invite_join</span><span class="params">(request,code)</span>:</span></span><br><span class="line">    <span class="string">"""访问邀请码"""</span></span><br><span class="line">    <span class="comment"># 获取当前时间</span></span><br><span class="line">    current_datetime = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line">    invite_obj = models.ProjectInvite.objects.filter(code=code).first()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> invite_obj:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'error'</span>:<span class="string">'邀请码不存在'</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> invite_obj.project.creator == request.tracer.user:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'error'</span>:<span class="string">'创建者无需再加入项目'</span>&#125;)</span><br><span class="line">    exists = models.ProjectUser.objects.filter(project=invite_obj.project,user=request.tracer.user).exists()</span><br><span class="line">    <span class="keyword">if</span> exists:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'error'</span>:<span class="string">'已经加入项目'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最多允许的成员</span></span><br><span class="line">    max_member = invite_obj.project.creator</span><br><span class="line">    <span class="comment"># 获取创建该项目的用户的交易记录</span></span><br><span class="line">    max_transaction = models.Transaction.objects.filter(user=invite_obj.project.creator).order_by(<span class="string">'-id'</span>).first()</span><br><span class="line">    <span class="comment"># 判断该交易是否过期</span></span><br><span class="line">    <span class="keyword">if</span> max_transaction.price_policy.category == <span class="number">1</span>:</span><br><span class="line">        max_member = max_transaction.price_policy.project_member</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> max_transaction.end_datetime &lt; current_datetime:</span><br><span class="line">            free_obj = models.PricePolicy.objects.filter(category=<span class="number">1</span>).first()</span><br><span class="line">            max_member = free_obj.project_member</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            max_member = max_transaction.price_policy.project_member</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 目前所有成员(创建者 &amp; 参与者)</span></span><br><span class="line">    current_member = models.ProjectUser.objects.filter(project=invite_obj.project).count()</span><br><span class="line">    current_member = current_member + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> current_member &gt;= max_member:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'error'</span>:<span class="string">'项目成员超限,请升级套餐'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 邀请码是否过期</span></span><br><span class="line">    limit_datetime = invite_obj.create_datetime + datetime.timedelta(minutes=invite_obj.period)</span><br><span class="line">    <span class="keyword">if</span> current_datetime &gt; limit_datetime:</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'error'</span>:<span class="string">'邀请码已过期'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数量限制</span></span><br><span class="line">    <span class="keyword">if</span> invite_obj.count:</span><br><span class="line">        <span class="keyword">if</span> invite_obj.use_count &gt;= invite_obj.count:</span><br><span class="line">            <span class="keyword">return</span> render(request, <span class="string">'manage/invite_join.html'</span>, &#123;<span class="string">'error'</span>: <span class="string">'邀请码数量使用完'</span>&#125;)</span><br><span class="line">        invite_obj.use_count += <span class="number">1</span></span><br><span class="line">        invite_obj.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 无数量限制 or 通过验证，加入要邀请项目</span></span><br><span class="line">    models.ProjectUser.objects.create(user=request.tracer.user,project=invite_obj.project)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新项目的参与人数</span></span><br><span class="line">    invite_obj.project.join_count += <span class="number">1</span></span><br><span class="line">    invite_obj.project.save()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'manage/invite_join.html'</span>,&#123;<span class="string">'project'</span>:invite_obj.project&#125;)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>前端展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'layout/manage.html' %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">    加入项目</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block css %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.no-radius</span> &#123;</span></span><br><span class="line">            border-radius: 0;</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% if error %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger no-radius"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-exclamation-triangle"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> &#123;&#123; error &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-success no-radius"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-check-circle"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 加入成功<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'dashboard' project_id=project.id%&#125;"</span>&gt;</span>点击跳转至项目<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Hp's blog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hpsj.github.io/2020/08/02/12%20%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86/">https://hpsj.github.io/2020/08/02/12%20%E9%97%AE%E9%A2%98%E7%AE%A1%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hpsj.github.io" target="_blank">Hp's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/08/02/13%20%E6%A6%82%E8%A7%88%20&amp;%20%E7%BB%9F%E8%AE%A1/"><img class="prev_cover lazyload" data-src="http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">概览 &amp; 统计</div></div></a></div><div class="next-post pull_right"><a href="/2020/08/02/11%20%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/"><img class="next_cover lazyload" data-src="http://hp256.gitee.io/blog/Django图片/SaaS平台.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">文件管理</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div id="lv-container" data-id="city" data-uid="MTAyMC80OTkxNy8yNjQwOA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Hp's blog</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>